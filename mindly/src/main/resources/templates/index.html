<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Mindly</title>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link rel="stylesheet" as="style" onload="this.rel='stylesheet'"
        href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700;900&display=swap" />
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />

    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
    <link rel="icon" type="image/png" sizes="32x32" th:href="@{/image/favicon-32x32.png}">
    <link rel="icon" type="image/png" sizes="18x18" th:href="@{/image/favicon-180x180.png}">


    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body class="min-h-screen flex flex-col">

    <div th:replace="~{fragmentos/navbar :: navbar}"></div>

    <div class="flex flex-row justify-center items-start min-h-[80vh] px-10 py-8 gap-10 flex-1">
        <div class="bg-caixa rounded-lg shadow-md p-6 w-[380px] min-h-[600px]">
            <h2 class="text-xl font-bold text-concreto mb-4" id="titulo-consultas">
                Consultas do dia
                <span th:text="${#temporals.format(dataSelecionada, 'dd/MM/yyyy')}"></span>
            </h2>
            <ul id="listaConsultasHoje">
                <li th:if="${consultasData == null or consultasData.empty}" class="text-gray-500 text-concreto">
                    Nenhuma consulta marcada para esta data.
                </li>
                <li th:each="consulta : ${consultasData}" class="mb-3 border-b pb-2 last:border-b-0 last:pb-0">
                    <div class="flex flex-col">
                        <span class="font-semibold text-concreto" th:text="${consulta.paciente.nome}">Paciente</span>
                        <span class="text-sm text-concreto"
                            th:text="${#temporals.format(consulta.dataConsulta, 'HH:mm')}">Hora</span>
                        <span class="text-xs text-concreto" th:text="${consulta.medico}">Médico</span>
                    </div>
                </li>
            </ul>
        </div>
        <div class="bg-caixa rounded-lg shadow-md p-6 w-[600px] min-h-[600px] flex flex-col items-center">
            <h2 class="text-xl font-bold text-concreto mb-4">Calendário</h2>
            <div id="calendario" style="width:100%;"></div>
        </div>
    </div>

    <div th:replace="~{fragmentos/footer :: footer}"></div>

    <script th:src="@{/js/home.js}"></script>

    <script th:inline="javascript">
        // Prepara a lista de eventos no formato que o FullCalendar espera
        const eventos = [
            /*[# th:each="consulta : ${consultasTodas}" ]*/
            {
                title: /*[[${consulta.paciente.nome}]]*/ 'Paciente',
                start: /*[[${#temporals.format(consulta.dataConsulta, 'yyyy-MM-dd\'T\'HH:mm')}]]*/ '2025-09-01T14:00'
            }
            /*[/]*/
        ];

        // Obtém a data selecionada (pode ser nula)
        const dataInicial = /*[[${dataSelecionada != null ? #temporals.format(dataSelecionada, 'yyyy-MM-dd') : null}]]*/ null;

        // Executa o script quando o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', function () {
            // Chama a função do arquivo home.js, passando os dados do Thymeleaf
            inicializarCalendario(eventos, dataInicial);
        });
    </script>
</body>

</html>